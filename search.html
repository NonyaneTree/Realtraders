<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>XIIchat2.5</title>
  <style>
    :root {
      --primary-color: #2962ff;
      --primary-light: #768fff;
      --primary-dark: #0039cb;
      --secondary-color: #ff6d00;
      --background: #f5f7fa;
      --card-bg: #ffffff;
      --text-primary: #263238;
      --text-secondary: #607d8b;
      --success-color: #00c853;
      --warning-color: #ffab00;
      --error-color: #ff1744;
    }
    
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background-color: var(--background);
      margin: 0;
      padding: 20px;
      color: var(--text-primary);
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: var(--card-bg);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
    }
    
    h1 {
      text-align: center;
      margin-bottom: 25px;
      color: var(--primary-dark);
      font-weight: 600;
    }
    
    .chat-container {
      display: flex;
      flex-direction: column;
      height: 500px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 20px;
      background: var(--card-bg);
    }
    
    .chat-box {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      background: var(--card-bg);
    }
    
    .message {
      margin: 12px 0;
      padding: 10px 15px;
      border-radius: 12px;
      max-width: 75%;
      line-height: 1.4;
      position: relative;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    
    .user {
      background-color: var(--primary-light);
      color: white;
      margin-left: auto;
      border-bottom-right-radius: 4px;
    }
    
    .bot {
      background-color: #f1f3f4;
      margin-right: auto;
      border-bottom-left-radius: 4px;
      color: var(--text-primary);
    }
    
    .input-area {
      display: flex;
      gap: 10px;
      padding: 15px;
      background: #f8f9fa;
      border-top: 1px solid #e0e0e0;
    }
    
    input[type="text"], input[type="file"] {
      flex: 1;
      padding: 12px 15px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      outline: none;
      transition: border 0.3s;
    }
    
    input[type="text"]:focus, input[type="file"]:focus {
      border-color: var(--primary-color);
    }
    
    button {
      padding: 12px 20px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
      white-space: nowrap;
    }
    
    button:hover {
      background-color: var(--primary-dark);
      transform: translateY(-1px);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .secondary-btn {
      background-color: #e0e0e0;
      color: var(--text-primary);
    }
    
    .secondary-btn:hover {
      background-color: #bdbdbd;
    }
    
    .canvas-container {
      margin-top: 25px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
      background: white;
    }
    
    canvas {
      display: block;
      width: 100%;
      background: white;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    
    .timestamp {
      font-size: 11px;
      color: var(--text-secondary);
      margin-top: 4px;
      text-align: right;
    }
    
    .bot-name {
      font-weight: 600;
      color: var(--primary-dark);
      margin-bottom: 4px;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      .chat-container {
        height: 400px;
      }
      
      .message {
        max-width: 85%;
      }
      
      .input-area {
        flex-direction: column;
      }
      
      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Forex Zone Assistant</h1>
    
    <div class="chat-container">
      <div class="chat-box" id="chatBox">
        <div class="message bot">
          <div class="bot-name">FX Assistant</div>
          Hi! I can help analyze Forex charts. Upload a chart image or describe a zone you're seeing.
          <div class="timestamp">Just now</div>
        </div>
      </div>
      
      <div class="input-area">
        <input type="text" id="userInput" placeholder="Describe the zone or ask a question...">
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>
    
    <div class="action-buttons">
      <input type="file" id="imageInput" accept="image/*" onchange="previewImage()">
      <button onclick="analyzeImage()">Analyze Chart</button>
      <button class="secondary-btn" onclick="clearCanvas()">Clear Chart</button>
    </div>
    
    <div class="canvas-container">
      <canvas id="canvas" width="950" height="500"></canvas>
    </div>
  </div>

  <script>
    const chatBox = document.getElementById('chatBox');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let uploadedImage = null;

    function appendMessage(text, isUser) {
      const msg = document.createElement('div');
      msg.className = 'message ' + (isUser ? 'user' : 'bot');
      
      if (!isUser) {
        const botName = document.createElement('div');
        botName.className = 'bot-name';
        botName.textContent = 'FX Assistant';
        msg.appendChild(botName);
      }
      
      msg.appendChild(document.createTextNode(text));
      
      const timestamp = document.createElement('div');
      timestamp.className = 'timestamp';
      timestamp.textContent = formatTime(new Date());
      msg.appendChild(timestamp);
      
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function formatTime(date) {
      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    function sendMessage() {
      const input = document.getElementById('userInput');
      const msg = input.value.trim();
      if (!msg) return;
      
      appendMessage(msg, true);
      input.value = '';
      
      // Simulate typing indicator
      setTimeout(() => {
        const response = generateZoneResponse(msg);
        appendMessage(response, false);
      }, 800);
    }

    function generateZoneResponse(text) {
      const lower = text.toLowerCase();
      
      if (lower.includes('supply') || lower.includes('sell')) {
        return 'Supply Zone: This is where sellers dominate, typically formed after a strong downward move. Price often reacts downward when returning to this area.';
      } else if (lower.includes('demand') || lower.includes('buy')) {
        return 'Demand Zone: This is where buyers dominate, usually formed after a strong upward move. Price often reacts upward when returning to this area.';
      } else if (lower.includes('breaker')) {
        return 'Breaker Block: A previous support/resistance level that was broken aggressively. It often becomes the opposite kind of level (support becomes resistance or vice versa).';
      } else if (lower.includes('liquidity')) {
        return 'Liquidity Zone: Areas where many stop orders are clustered. Institutional traders often target these zones to trigger stops before reversing.';
      } else if (lower.includes('hello') || lower.includes('hi')) {
        return 'Hello! How can I assist with your Forex analysis today?';
      } else if (lower.includes('thank')) {
        return "You're welcome! Let me know if you need any more help with your analysis.";
      } else {
        return "I'm not sure I understand. Try asking about supply/demand zones, breaker blocks, or liquidity areas. You can also upload a chart image for analysis.";
      }
    }

    function previewImage() {
      const input = document.getElementById('imageInput');
      const file = input.files[0];
      
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function() {
        uploadedImage = new Image();
        uploadedImage.onload = () => {
          // Maintain aspect ratio but limit to canvas size
          const ratio = Math.min(
            canvas.width / uploadedImage.width,
            canvas.height / uploadedImage.height
          );
          
          const newWidth = uploadedImage.width * ratio;
          const newHeight = uploadedImage.height * ratio;
          
          // Clear canvas and draw centered image
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(
            uploadedImage, 
            (canvas.width - newWidth) / 2, 
            (canvas.height - newHeight) / 2, 
            newWidth, 
            newHeight
          );
          
          appendMessage("Chart image uploaded successfully. Click 'Analyze Chart' to identify zones.", false);
        }
        uploadedImage.src = reader.result;
      };
      reader.readAsDataURL(file);
    }

    function analyzeImage() {
      if (!uploadedImage) {
        appendMessage("Please upload a chart image first.", false);
        return;
      }
      
      appendMessage("Analyzing chart for potential zones...", false);
      
      // Simulate analysis delay
      setTimeout(() => {
        // Redraw the image
        const ratio = Math.min(
          canvas.width / uploadedImage.width,
          canvas.height / uploadedImage.height
        );
        const newWidth = uploadedImage.width * ratio;
        const newHeight = uploadedImage.height * ratio;
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(
          uploadedImage, 
          (canvas.width - newWidth) / 2, 
          (canvas.height - newHeight) / 2, 
          newWidth, 
          newHeight
        );
        
        // Simulate finding zones (demo only)
        const centerY = (canvas.height - newHeight) / 2 + newHeight / 2;
        const zoneHeight = newHeight * 0.15;
        
        // Draw demand zone (bottom)
        ctx.fillStyle = 'rgba(0, 200, 83, 0.2)';
        ctx.fillRect(
          (canvas.width - newWidth) / 2,
          centerY + zoneHeight,
          newWidth,
          zoneHeight
        );
        
        // Draw supply zone (top)
        ctx.fillStyle = 'rgba(239, 83, 80, 0.2)';
        ctx.fillRect(
          (canvas.width - newWidth) / 2,
          centerY - zoneHeight * 2,
          newWidth,
          zoneHeight
        );
        
        // Add labels
        ctx.font = '14px Arial';
        ctx.fillStyle = '#00c853';
        ctx.fillText('Potential Demand Zone', 20, centerY + zoneHeight * 1.5);
        
        ctx.fillStyle = '#ef5350';
        ctx.fillText('Potential Supply Zone', 20, centerY - zoneHeight * 1.2);
        
        appendMessage("Analysis complete! I've highlighted potential supply (red) and demand (green) zones on your chart.", false);
      }, 1500);
    }
    
    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      uploadedImage = null;
      document.getElementById('imageInput').value = '';
      appendMessage("Chart cleared. You can upload a new image.", false);
    }

    document.getElementById('userInput').addEventListener('keypress', e => {
      if (e.key === 'Enter') sendMessage();
    });
  </script>
</body>
</html>
